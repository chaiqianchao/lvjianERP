<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>工程项目详细</title>
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
	<link rel="stylesheet" type="text/css" href="__STATIC__/css/details.css">
	<link rel="stylesheet" type="text/css" href="__STATIC__/css/font.css" />
	<link rel="stylesheet" type="text/css" href="__STATIC__/css/xadmin.css" />
	<script type="text/javascript" src="__STATIC__/lib/layui/layui.js"></script>
	<script type="text/javascript" src="__STATIC__/js/xadmin.js"></script>
    <script type="text/javascript" src="__STATIC__/js/FileSave.js"></script>

</head>
<body>
<div class="card">
<div class="layui-col-md12">
<div class="layui-card" >
	<div class="back-pro" style="background-color: #fff;padding-bottom: 10px;"><a href="javascript:history.go(-1)">返回</a></div>
    <div class="layui-card-body">
        <p>&nbsp&nbsp&nbsp工程号：{$jibenxinxi["project_id"]}</p>
        <!-- 1 -->
                <div class="layui-collapse" lay-filter="test">
                    <div class="layui-colla-item">
                        <h2 class="layui-colla-title">基本信息<i class="layui-icon layui-colla-icon"></i></h2>
                        <div class="layui-colla-content" style="overflow-x: scroll;">
                            <table class="layui-table layui-form" id="table1">
                                <tbody style="position: absolute;">
                                    <tr style="visibility: hidden ;">
                                        <th>工程号</th>
                                        <td>&nbsp;{$jibenxinxi["project_id"]}</td>
                                    </tr>
                                </tbody>
                                <td>工程名称</td>
                                <td>发包人</td>
                                <td>代建方</td>
                                <td>用地面积/㎡</td>
                                <td>地上面积/㎡</td>
                                <td>地下面积/㎡</td>
                                <td>其中人防/㎡</td>
                                <td>总建筑面积/㎡</td>
                                <td>建筑类型</td>
                                <td>项目负责人</td>
                                <td>设计内容</td>
                                <td>工种负责</td>
                                <td>备注</td>
                                <tbody>
                                <tr class="text-c">
                                    <td>{$jibenxinxi["project_name"]}</td>
                                    <td>{$jibenxinxi["project_contractor"]}</td>
                                    <td>{$jibenxinxi["project_agent"]}</td>
                                    <td>{$jibenxinxi["project_landarea"]}</td>
                                    <td>{$jibenxinxi["aboveground_area"]}</td>
                                    <td>{$jibenxinxi["underground_area"]}</td>
                                    <td>{$jibenxinxi["among_area"]}</td>
                                    <td>{$jibenxinxi["project_totalarea"]}</td>
                                    <td>{$jibenxinxi["project_buildtype"]}</td>
                                    <td>{$jibenxinxi["project_leader"]}</td>
                                    <td>{$jibenxinxi["project_design"]}</td>
                                    <td>{$jibenxinxi["project_leader"]}</td>
                                    <td>{$jibenxinxi["project_remark"]}</td>
                                </tr>
                                <tr class="text-c">
                            <td><a title="编辑" onclick="member_edit('{$jibenxinxi["project_id"]}', 'project_name','工程名称','{$jibenxinxi["project_name"]}','projectEdit')" href="javascript:;">
                                      <i class="layui-icon">&#xe642;</i>
                                    </a></td>
                            <td><a title="编辑" onclick="member_edit('{$jibenxinxi["project_id"]}', 'project_contractor', '发包人', '{$jibenxinxi["project_contractor"]}', 'projectEdit')" href="javascript:;">
                                  <i class="layui-icon">&#xe642;</i>
                                </a></td>
                            <td><a title="编辑" onclick="member_edit('{$jibenxinxi["project_id"]}', 'project_agent', '代建方', '{$jibenxinxi["project_agent"]}', 'projectEdit')" href="javascript:;">
                                  <i class="layui-icon">&#xe642;</i>
                                </a></td>
                            <td><a title="编辑" onclick="member_edit('{$jibenxinxi["project_id"]}','project_landarea', '用地面积', '{$jibenxinxi["project_landarea"]}', 'projectEdit')" href="javascript:;">
                                  <i class="layui-icon">&#xe642;</i>
                                </a></td>
                            <td><a title="编辑" onclick="member_edit('{$jibenxinxi["project_id"]}','aboveground_area', '地上面积', '{$jibenxinxi["aboveground_area"]}', 'projectEdit')" href="javascript:;">
                                  <i class="layui-icon">&#xe642;</i>
                                </a></td>
                            <td><a title="编辑" onclick="member_edit('{$jibenxinxi["project_id"]}','underground_area', '地下面积', '{$jibenxinxi["underground_area"]}', 'projectEdit')" href="javascript:;">
                                  <i class="layui-icon">&#xe642;</i>
                                </a></td>
                            <td> <a title="编辑" onclick="member_edit('{$jibenxinxi["project_id"]}','among_area', '其中人防', '{$jibenxinxi["among_area"]}', 'projectEdit')" href="javascript:;">
                                  <i class="layui-icon">&#xe642;</i>
                                </a></td>
                            <td><a title="编辑" onclick="member_edit('{$jibenxinxi["project_id"]}', 'project_totalarea', '总建筑面积', '{$jibenxinxi["project_totalarea"]}', 'projectEdit')" href="javascript:;">
                                  <i class="layui-icon">&#xe642;</i>
                                </a></td>
                            <td><a title="编辑" onclick="member_edit('{$jibenxinxi["project_id"]}', 'project_buildtype', '建筑类型', '{$jibenxinxi["project_buildtype"]}', 'projectEdit1')" href="javascript:;">
                                  <i class="layui-icon">&#xe642;</i>
                                </a></td>
                            <td> <a title="编辑" onclick="member_edit('{$jibenxinxi["project_id"]}', 'project_leader', '项目负责人', '{$jibenxinxi["project_leader"]}', 'projectEdit')" href="javascript:;">
                                  <i class="layui-icon">&#xe642;</i>
                                </a></td>
                            <td><a title="编辑" onclick="member_edit('{$jibenxinxi["project_id"]}', 'project_design', '设计内容', '{$jibenxinxi["project_design"]}', 'projectContentEdit')" href="javascript:;">
                                  <i class="layui-icon">&#xe642;</i>
                                </a></td>
                            <td><a title="编辑" onclick="member_edit('{$jibenxinxi["project_id"]}', 'project_leader', '工种负责', '{$jibenxinxi["project_leader"]}', 'projectEdit')" href="javascript:;">
                                  <i class="layui-icon">&#xe642;</i>
                                </a></td>
                            <td> <a title="编辑" onclick="member_edit('{$jibenxinxi["project_id"]}', 'project_remark', '备注', '{$jibenxinxi["project_remark"]}', 'projectEdit')" href="javascript:;">
                                  <i class="layui-icon">&#xe642;</i>
                                </a></td>
                        </tr>
                                </tbody>
                            </table>
                            <button class="layui-btn" onclick="leadingOut1()" style="background-color: #319587;margin-right: 10px;">导出数据</button>
                        </div>
                    </div>
                </div>
		<!-- 2 -->
		<div class="layui-collapse" lay-filter="test">
            <div class="layui-colla-item">
                <h2 class="layui-colla-title">设计人员信息<i class="layui-icon layui-colla-icon"></i></h2>
                <div class="layui-colla-content">
                    <table class="layui-table" id="table2">
                        <tbody style="position: absolute;">
                            <tr style="visibility: hidden ;">
                                <th>工程号</th>
                                <td colspan="4">&nbsp;{$jibenxinxi["project_id"]}</td>
                            </tr>
                            <tr style="visibility: hidden ;">
                                <th>工程名称</th>
                                <td colspan="4">{$jibenxinxi["project_name"]}</td>
                            </tr>
                        </tbody>
                        <tbody>
                            <tr class="text-c">
                                <th>设计内容</th>
                                <th>设计人</th>
                                <th>工种负责人</th>
                                <th>分包人</th>
                                <th class="td-manage">操作</th>
                            </tr>
                        	{volist name='shejirenyuan' id='vo'}
							<tr class="text-c">
								<th>{$vo["project_design"]}</th>
								<td>{$vo["projectdesigner_design"]}</td>
                                <td>{$vo["projectdesigner_type"]}</td>
                                <td>{$vo["project_subcontractor"]}</td>
								<td class="td-manage">
                                    {if condition="$limit eq 2"}
                                    <a title="编辑" onclick="member_edit('{$vo["project_id"]}', '{$vo["project_design"]}','{$vo["project_design"]}','{$vo["projectdesigner_design"]}*{$vo["projectdesigner_type"]}*{$vo["project_subcontractor"]}','designerEdit')" href="javascript:;">
                                      <i class="layui-icon">&#xe642;</i>
                                    </a>
                                    {/if}
	                            </td>
							</tr>
							{/volist}
                        </tbody>
                    </table>
                    <button class="layui-btn" onclick="leadingOut2()" style="background-color: #319587;margin-right: 10px;">导出数据</button>
                </div>
            </div>
        </div>
        <!-- 3 -->
		<div class="layui-collapse" lay-filter="test">
            <div class="layui-colla-item">
                <h2 class="layui-colla-title">阶段计划<i class="layui-icon layui-colla-icon"></i></h2>
                <div class="layui-colla-content">
                    <table class="layui-table" id="table3">
                        <tbody style="position: absolute;">
                            <tr style="visibility: hidden ;">
                                <th>工程号</th>
                                <td colspan="2">&nbsp;{$jibenxinxi["project_id"]}</td>
                            </tr>
                            <tr style="visibility: hidden ;">
                                <th>工程名称</th>
                                <td colspan="2">{$jibenxinxi["project_name"]}</td>
                            </tr>
                        </tbody>
                        <tbody>
                            <tr class="text-c">
                                <th>阶段</th>
                                <th>计划内容</th>
                                <th class="td-manage">操作</th>
                            </tr>
                             {volist name='note' id='vo'}
							<tr class="text-c">
								<td>{$vo["Comment"]}</td>
								<td>{$vo["cont"]}</td>
								<td class="td-manage">
                                    {if condition="$limit eq 2"}
		                            <a title="编辑" onclick="member_edit('{$jibenxinxi["project_id"]}', '{$vo["Field"]}', '{$vo["Comment"]}', '{$vo["cont"]}', 'ProjectDrawEdit')" href="javascript:;">
                                      <i class="layui-icon">&#xe642;</i>
                                    </a>
                                    {/if}
	                            </td>
							</tr>
							{/volist}
                        </tbody>
                    </table>
                    <button class="layui-btn" onclick="leadingOut3()" style="background-color: #319587;margin-right: 10px;">导出数据</button>
                </div>
            </div>
        </div>
        <!-- 5 -->
		<div class="layui-collapse" lay-filter="test">
            <div class="layui-colla-item">
                <h2 class="layui-colla-title">完成计划<i class="layui-icon layui-colla-icon"></i></h2>
                <div class="layui-colla-content">
                    <table class="layui-table" id="table4">
                        <tbody style="position: absolute;">
                            <tr style="visibility: hidden ;">
                                <th>工程号</th>
                                <td colspan="2">&nbsp;{$jibenxinxi["project_id"]}</td>
                            </tr>
                            <tr style="visibility: hidden ;">
                                <th>工程名称</th>
                                <td colspan="2">{$jibenxinxi["project_name"]}</td>
                            </tr>
                        </tbody>
                        <tbody>
                            <tr class="text-c">
                                <th>阶段</th>
                                <th>完成时间</th>
                                <th class="td-manage">操作</th>
                            </tr>
                            {volist name='plan' id='vo'}
                            {if condition="$vo.cont eq '0000-01-01'"}
								<tr class="text-c">
										<td>{$vo["Comment"]}</td>
										<td></td>
										<td class="td-manage">
                                            {if condition="$limit eq 2"}
		                                    <a title="编辑" onclick="member_edit('{$jibenxinxi["project_id"]}', '{$vo["Field"]}', '{$vo["Comment"]}', '{$vo["cont"]}', 'projectPhaseEdit')" href="javascript:;"><i class="layui-icon">&#xe642;</i></a>
                                            {/if}
	                                    </td>
									</tr>

                            {else}
								<tr class="text-c">
										<td>{$vo["Comment"]}</td>
										<td>{$vo["cont"]}</td>
										<td class="td-manage">
                                            {if condition="$limit eq 2"}
		                                    <a title="编辑" onclick="member_edit('{$jibenxinxi["project_id"]}', '{$vo["Field"]}', '{$vo["Comment"]}', '{$vo["cont"]}', 'projectPhaseEdit')" href="javascript:;"><i class="layui-icon">&#xe642;</i></a>
                                            {/if}
	                                    </td>
									</tr>
							{/if}
							{/volist}
                        </tbody>
                    </table>
                    <button class="layui-btn" onclick="leadingOut4()" style="background-color: #319587;margin-right: 10px;">导出数据</button>
                </div>
            </div>
        </div>
        <!-- 6 -->
        <div class="layui-collapse" lay-filter="test">
            <div class="layui-colla-item">
                <h2 class="layui-colla-title">工程产值<i class="layui-icon layui-colla-icon"></i></h2>
                <div class="layui-colla-content">
                    <table class="layui-table layui-form">
                    <thead>
                    <th>工程名称</th>
                    <th>项目名称</th>
                    <th>出图时间</th>
                    <th>部门</th>
                    <th>设计面积</th>
                    {if condition="$contract_amount_limit eq 1"}
                    <th>主体合同额</th>
                    {/if}
                    <th>产值额</th>
                    <th>详情</th>
                    </thead>
                    <tbody>
                    {volist name='projectvalue' id='vo'}
                    <tr class="text-c">
                    <td>{$jibenxinxi.project_name}</td>
                    <td>{$vo.entry_name}</td>
                    <td>{$vo.drawing_time}</td>
                    <td>{$vo.department}</td>
                    <td>{$vo.design_area}</td>
                    {if condition="$contract_amount_limit eq 1"}
                    <td>{$vo.contract_amount}</td>
                    {/if}
                    <td>{$vo.value_subtotal}</td>
                    <td><a href="{:url("index/projectValue_details",["project_id"=>$vo["project_id"]])}" >点击详情</a></td>
                  </tr>
                    {/volist}
                    </tbody>
                  </table>
                </div>
            </div>
        </div>
        <table class="layui-table">
                    <tbody>

                        <tr>
                            <th>公告</th>
                            <td id="notice"></td>
                            <th class="td-manage">
                                {if condition="$limit eq 2"}
                                <a title="编辑公告" onclick="member_edit('{$jibenxinxi["project_id"]}', 'project_notice', '公告', '{$jibenxinxi["project_notice"]}', 'noticeEdit')" style="margin-right: 10px;text-decoration: underline;cursor: pointer;">
                                  编辑公告 
                                </a>
                                <a title="添加公告" onclick="notice_add('{$jibenxinxi["project_id"]}')" href="javascript:;" style="text-decoration: underline;">
                                  添加公告
                                </a>
                                {/if}
                            </th>
                        </tr>
                       
                    </tbody>
                </table>
        <div class="layui-card layui-input-block">
            <button class="layui-btn" onclick="deleteThis()" style="background-color: #F4592E;">删除当前数据</button>
        </div>
    </div>
</div>
</div>
</div>
<script type="text/javascript">
var notices = '{$jibenxinxi["project_notice"]}'
var notice = notices.split(";");
var tdNotice = document.getElementById('notice');
tdNotice.innerHTML = "";
for (var i = 0; i < notice.length - 1; i++) {
    tdNotice.innerHTML += notice[i]+"<br>";
}

function notice_add(id) {
    var url = '{:url("index/notice_add")}' +"?id="+id;
    xadmin.open('添加公告', url);
}
function member_edit(id, column, chinese, content, type) {
    var url = '{:url("index/detailEdit")}' +"?id="+id+"&column="+column+"&chinese="+chinese+"&content="+content+"&type="+type;
    xadmin.open('详情修改', url);
	
}
function deleteThis() {
    layer.alert("您确定要删除当前工程的所有数据吗？",
        function() {
            $.ajax({
            type: "post",
            url: "{:url('index/ProjectDel')}",
            data:"project_id={$jibenxinxi['project_id']}",
            success: function (data) {
                alert("success:"+data.message);
                  layer.alert("删除成功！",
                function() {
                    xadmin.close();
                    xadmin.father_reload();
                });
            },
            error: function(data) {
                alert("error:"+data.message);
             }
         });
        
        });
}
function leadingOut1() {
  //询问框
  layer.confirm('只能导出该工程基本信息数据，请问依旧要导出吗？', {
    btn: ['取消导出','依旧导出'] //按钮
  }, function(){
    layer.msg('已取消', {icon: 1});
  }, function(){
    tableToExcel('table1','sheet1',template,'Data.xlsx');
  });
}
function leadingOut2() {
  //询问框
  layer.confirm('只能导出该工程设计人员信息的数据，请问依旧要导出吗？', {
    btn: ['取消导出','依旧导出'] //按钮
  }, function(){
    layer.msg('已取消', {icon: 1});
  }, function(){
    tableToExcel('table2','sheet1',template,'Data.xlsx');
  });
}
function leadingOut3() {
  //询问框
  layer.confirm('只能导出该工程阶段计划的数据，请问依旧要导出吗？', {
    btn: ['取消导出','依旧导出'] //按钮
  }, function(){
    layer.msg('已取消', {icon: 1});
  }, function(){
    tableToExcel('table3','sheet1',template,'Data.xlsx');
  });
}
function leadingOut4() {
  //询问框
  layer.confirm('只能导出该工程完成计划的数据，请问依旧要导出吗？', {
    btn: ['取消导出','依旧导出'] //按钮
  }, function(){
    layer.msg('已取消', {icon: 1});
  }, function(){
    tableToExcel('table4','sheet1',template,'Data.xlsx');
  });
}
var template =
    ' <style type="text/css">' +
    'table {' +
    '    font-family: verdana,arial,sans-serif;' +
    '    font-size:11px;' +
    '    color:#333333;' +
    '    border-width: 1px;' +
    '    border-color: #666666;' +
    '    border-collapse: collapse;' +
    '}' +
    'table th {' +
    '    padding: 8px;' +
    '    width: 200px;' +
    '  height: 30px;' +
    '    border-style: solid;' +
    '    border-color: #9a9a9a;' +
    '    color: #ffffff;' +
    '    background-color: #319587;' +
    '}' +
    'table td {' +
    '    width: 200px;' +
    '  height: 30px;' +
    '    padding: 8px;' +
    '    text-align: center;' +
    '    border-style: solid;' +
    '    border-color: #9a9a9a;' +
    '}' +
    ' ' +
    '</style>';

function tableToExcel(tableid, sheetName, template, fileName) {
    if (!tableid.nodeType) tableid = document.getElementById(tableid);
    var html = "<html xmlns:x=\"urn:schemas-microsoft-com:office:excel\">\n" +
        "    <head>\n" +
        "        <!--[if gte mso 9]><xml>\n" +
        "            <x:ExcelWorkbook>\n" +
        "                <x:ExcelWorksheets>\n" +
        "                    <x:ExcelWorksheet>\n" +
        "                        <x:Name>"+ sheetName +"</x:Name>\n" +
        "                        <x:WorksheetOptions>\n" +
        "                            <x:Print>\n" +
        "                                <x:ValidPrinterInfo />\n" +
        "                            </x:Print>\n" +
        "                        </x:WorksheetOptions>\n" +
        "                    </x:ExcelWorksheet>\n" +
        "                </x:ExcelWorksheets>\n" +
        "            </x:ExcelWorkbook>\n" +
        "        </xml>\n" +
        "        <![endif]-->\n" + template +
        "    </head>" +
        "<body>" + tableid.outerHTML +
        "</body></html>";
    var blob = new Blob([html], {type: "text/plain;charset=utf-8"});
    saveAs(blob, fileName);
}
</script>
</body>
</html>